<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Relay Control Dashboard</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- MQTT.js CDN -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>

<body class="bg-gray-100 font-sans">
  <main class="container mx-auto min-h-screen p-4">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <div class="rounded-lg bg-white p-6 shadow-lg text-center">
        <h2 class="text-xl font-semibold mb-4">Relay 1 (FAN)</h2>
        <button id="relay1Btn" class="relay-btn bg-green-500">Turn ON</button>
      </div>
      <div class="rounded-lg bg-white p-6 shadow-lg text-center">
        <h2 class="text-xl font-semibold mb-4">Relay 2 (PUMP)</h2>
        <button id="relay2Btn" class="relay-btn bg-green-500">Turn ON</button>
      </div>
      <div class="rounded-lg bg-white p-6 shadow-lg text-center">
        <h2 class="text-xl font-semibold mb-4">Relay 3 (LIGHT)</h2>
        <button id="relay3Btn" class="relay-btn bg-green-500">Turn ON</button>
      </div>
      <div class="rounded-lg bg-white p-6 shadow-lg text-center">
        <h2 class="text-xl font-semibold mb-4">Relay 4 (ALARM)</h2>
        <button id="relay4Btn" class="relay-btn bg-green-500">Turn ON</button>
      </div>
    </div>
  </main>

  <script>
    // MQTT Connection
    const client = mqtt.connect('wss://7d677df85f0a4b2ca584c9e9c7f3a1de.s1.eu.hivemq.cloud:8884/mqtt', {
      clientId: 'relay-dashboard',
      clean: true,
      username: 'fanapb',
      password: 'Admin12345'
    });

    const pubTopic = 'relay/control'; // Pastikan ESP32 subscribe topik ini

    client.on('connect', () => {
      console.log('MQTT connected');
    });

    client.on('error', err => {
      console.error('MQTT Error:', err);
    });

    // State for each relay
    const relayStates = [false, false, false, false];

    function toggleRelay(index) {
      relayStates[index] = !relayStates[index];
      const relayNumber = index + 1;
      const state = relayStates[index] ? "ON" : "OFF";
      const message = JSON.stringify({ relay: relayNumber, state });

      client.publish(pubTopic, message);

      const btn = document.getElementById(`relay${relayNumber}Btn`);
      btn.textContent = relayStates[index] ? "Turn OFF" : "Turn ON";
      btn.classList.toggle('bg-green-500', !relayStates[index]);
      btn.classList.toggle('bg-red-500', relayStates[index]);
    }

    // Attach event listeners
    for (let i = 1; i <= 4; i++) {
      document.getElementById(`relay${i}Btn`).addEventListener('click', () => toggleRelay(i - 1));
    }
  </script>

  <style>
    .relay-btn {
      @apply px-6 py-3 text-white font-bold rounded-xl transition-colors hover:brightness-110;
    }
  </style>
</body>

</html>
